# Podman Security Configuration
# Daemon-less container security settings for cybersecurity training platform

[containers]
# Default security options for all containers
default_capabilities_drop = ["ALL"]
default_sysctls = ["net.ipv4.ping_group_range=0 0"]
default_ulimits = ["nofile=1024:2048", "nproc=64:128"]

# Security enforcement
no_new_privileges = true
read_only = false  # Challenge containers may need write access
seccomp_profile = "/usr/share/containers/seccomp.json"
apparmor_profile = "containers-default-0.44.1"
selinux = true

# User namespace configuration
userns = "auto"
userns_size = 65536

# Container user settings
user = "1000:1000"
group_add = []

# Resource limits
default_memory = "256m"
default_cpu_shares = 1024
default_pids_limit = 128

[network]
# Network security settings
default_network = "podman"
network_cmd_options = ["enable_ipv6=false"]
dns_bind_port = 0

# Disable host network access by default
default_net_cmd = "pasta"
netavark = true

[engine]
# Engine security configuration
cgroup_manager = "systemd"
events_logger = "journald"
runtime = "crun"

# Rootless storage configuration
rootless_storage_path = "$HOME/.local/share/containers/storage"
runroot = "$XDG_RUNTIME_DIR/containers"
graphroot = "$HOME/.local/share/containers/storage"

# Image configuration
image_default_transport = "docker://"
pull_policy = "missing"

# Security scanning (disabled for offline use)
short_name_aliasing = "enforcing"

[secrets]
# Secrets management
driver = "file"

[machine]
# Machine/VM settings (if applicable)
cpus = 2
memory = 2048
disk_size = 20

[volumes]
# Volume security
volume_path = "$HOME/.local/share/containers/storage/volumes"

[registries]
# Registry configuration for image pulls
short_name_mode = "enforcing"

# Default search registries
unqualified_search_registries = ["docker.io", "registry.redhat.io", "quay.io"]

# Registry security
search_registries = ["docker.io"]

[storage]
# Storage configuration
driver = "overlay"
runroot = "$XDG_RUNTIME_DIR/containers"
graphroot = "$HOME/.local/share/containers/storage"

[storage.options]
# Storage options
additionalimagestores = []
size = ""
mount_program = "/usr/bin/fuse-overlayfs"
skip_mount_home = false

[storage.options.overlay]
# Overlay storage options
mountopt = "nodev,metacopy=on"
size = ""

# Security-focused storage options
force_mask = "0022"
ignore_chown_errors = true
mount_program = "/usr/bin/fuse-overlayfs"

[log]
# Logging configuration for security audit
level = "info"
driver = "journald"
size_max = "10MB"
compress = true

[quota]
# Disk quota enforcement
enabled = false