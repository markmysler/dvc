---
phase: 05-container-lifecycle-hints
plan: 02
type: execute
wave: 1
depends_on: []
files_modified: [
  "engine/hint_service.py",
  "api/hints/route.js",
  "frontend/components/challenge/hint-panel.tsx",
  "frontend/hooks/useHints.ts"
]
autonomous: true

must_haves:
  truths:
    - "Users can request hints for active challenges"
    - "Hints unlock progressively over time"
    - "Hint status persists across page refreshes"
    - "Users see remaining time until next hint unlock"
  artifacts:
    - path: "engine/hint_service.py"
      provides: "Progressive hint disclosure logic"
      exports: ["HintService", "get_available_hints"]
    - path: "api/hints/route.js"
      provides: "Hint API endpoints"
      exports: ["GET", "POST"]
    - path: "frontend/components/challenge/hint-panel.tsx"
      provides: "Hint UI with progressive disclosure"
      min_lines: 40
    - path: "frontend/hooks/useHints.ts"
      provides: "Hint state management with TanStack Query"
      exports: ["useHints", "useRequestHint"]
  key_links:
    - from: "frontend/components/challenge/hint-panel.tsx"
      to: "frontend/hooks/useHints.ts"
      via: "React hook integration"
      pattern: "useHints\\("
    - from: "frontend/hooks/useHints.ts"
      to: "/api/hints"
      via: "API call with TanStack Query"
      pattern: "fetch.*api/hints"
    - from: "api/hints/route.js"
      to: "engine/hint_service.py"
      via: "Python service integration"
      pattern: "import.*hint_service"
---

<objective>
Implement progressive hint system enabling users to get contextual help for challenges with time-based and request-based disclosure.

Purpose: Enhance learning experience by providing adaptive hints that unlock over time while maintaining challenge difficulty balance.
Output: Complete hint system with progressive disclosure, UI integration, and session persistence.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-container-lifecycle-hints/05-RESEARCH.md

# Challenge structure with hints
@challenges/definitions/challenges.json
@engine/session_manager.py
@frontend/hooks/useChallenges.ts
</context>

<tasks>

<task type="auto">
  <name>Create progressive hint service</name>
  <files>engine/hint_service.py</files>
  <action>
    Create HintService class implementing progressive hint disclosure logic:

    - Time-based hint unlocking (5-minute intervals per hint)
    - Request-based hint unlocking (user can request early access)
    - Session-based hint state tracking
    - Configuration loading from challenge definitions
    - Hint unlock scheduling and timing calculations

    Key methods:
    - get_available_hints(challenge_id, session_data) -> dict with available hints
    - request_hint(challenge_id, session_id) -> unlock next hint early
    - get_hint_status(challenge_id, session_data) -> timing and availability info

    Hint response format:
    ```python
    {
        'available_hints': [
            {'index': 0, 'text': 'hint text', 'unlocked_by': 'time|request', 'unlocked_at': timestamp}
        ],
        'total_hints': 3,
        'next_unlock': timestamp_or_null,
        'hints_requested': 1
    }
    ```

    Use research HINT_UNLOCK_INTERVAL = 300 seconds (5 minutes). Load hints from challenge metadata.hints array.
  </action>
  <verify>
    python -c "from engine.hint_service import HintService; h = HintService(); print('HintService created successfully')"
  </verify>
  <done>HintService provides progressive hint disclosure with time-based and request-based unlocking</done>
</task>

<task type="auto">
  <name>Create hint API endpoints</name>
  <files>api/hints/route.js</files>
  <action>
    Create Express API endpoints for hint management:

    GET /api/hints?challenge_id=X&session_id=Y:
    - Return available hints for session using HintService
    - Include hint status, timing, and availability info
    - Handle session validation and error cases

    POST /api/hints with {challenge_id, session_id, action: 'request'}:
    - Request early hint unlock using HintService
    - Update session hint state
    - Return updated hint status

    Error handling:
    - 400 for invalid challenge_id or session_id
    - 404 for challenge/session not found
    - 429 for too many hint requests
    - 500 for service errors

    Use existing session manager integration pattern from other API routes. Ensure proper error responses and logging.
  </action>
  <verify>
    curl http://localhost:5000/api/hints?challenge_id=test&session_id=123 || echo "API route created"
  </verify>
  <done>Hint API endpoints handle GET for hint retrieval and POST for hint requests with proper error handling</done>
</task>

<task type="auto">
  <name>Create hint panel UI component</name>
  <files>frontend/components/challenge/hint-panel.tsx</files>
  <action>
    Create HintPanel component with progressive hint disclosure UI:

    - Display available hints with unlock status
    - Show countdown timer for next hint unlock
    - "Request Hint" button for early access
    - Hint numbering and progress indicator
    - Loading states and error handling
    - Responsive design with shadcn/ui components

    Component props:
    - challengeId: string
    - sessionId: string
    - className?: string

    UI features:
    - Card-based hint display with shadcn/ui Card
    - Progress indicator showing X of Y hints unlocked
    - Countdown timer using React state and useEffect
    - Button states: "Request Hint" / "Loading..." / "Next in 2:30"
    - Hint text with proper typography
    - Empty state when no hints available

    Use shadcn/ui components (Card, Button, Badge) for consistent design. Integrate with hint hooks for data management.
  </action>
  <verify>
    grep -l "HintPanel" frontend/components/challenge/hint-panel.tsx
  </verify>
  <done>HintPanel component provides progressive hint disclosure UI with countdown timers and request functionality</done>
</task>

<task type="auto">
  <name>Create hint state management hooks</name>
  <files>frontend/hooks/useHints.ts</files>
  <action>
    Create TanStack Query hooks for hint state management:

    useHints(challengeId, sessionId):
    - Fetch hint status and available hints
    - Auto-refresh every 30 seconds to update timers
    - Optimistic updates when requesting hints
    - Error handling and retry logic

    useRequestHint():
    - Mutation for requesting early hint access
    - Optimistic updates to hint state
    - Invalidate hint queries on success
    - Loading states and error handling

    Query configuration:
    - 30-second refetch interval for timing updates
    - staleTime: 10 seconds (hints change frequently)
    - Background refetch enabled for real-time updates
    - Retry failed requests 3 times

    Follow existing hook patterns from useChallenges.ts and useProgress.ts. Use proper TypeScript types for hint data structures.
  </action>
  <verify>
    grep -l "useHints\|useRequestHint" frontend/hooks/useHints.ts
  </verify>
  <done>Hint hooks provide TanStack Query integration for hint state management with real-time updates and optimistic mutations</done>
</task>

</tasks>

<verification>
- Hints unlock progressively based on time and requests
- UI shows countdown timers and hint availability
- Hint state persists across page refreshes
- API endpoints handle hint requests properly
</verification>

<success_criteria>
- Users can view progressive hints for active challenges
- Hint system balances learning assistance with challenge difficulty
- Hint status updates in real-time with countdown timers
- System tracks hint requests per session
</success_criteria>

<output>
After completion, create `.planning/phases/05-container-lifecycle-hints/05-02-SUMMARY.md`
</output>